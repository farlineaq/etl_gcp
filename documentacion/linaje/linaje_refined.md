# Linaje de Datos

# Tablas

- [clientes_leales](#clientes_leales)
- [clientes_monitoreados](#clientes_monitoreados)
- [dim_cadena](#dim_cadena)
- [dim_indicadores](#dim_indicadores)
- [indicadores_manuales](#indicadores_manuales)
- [indicadores_metas](#indicadores_metas)
- [porcentaje_contectabilidad](#porcentaje_contectabilidad)
- [tasa_retencion](#tasa_retencion)
- [transacciones_monitoreadas](#transacciones_monitoreadas)
- [ventas_clientes_leales](#ventas_clientes_leales)
- [ventas_totales](#ventas_totales)
 
# clientes_leales

| Mapeo de datos                                   |                                                           |                                                                     |                                                           |                                                          |                                                                        |                             |                                          |
|--------------------------------------------------|-----------------------------------------------------------|---------------------------------------------------------------------|-----------------------------------------------------------|----------------------------------------------------------|------------------------------------------------------------------------|-----------------------------|------------------------------------------|
| Nombre del componente: BigQuery Stored Procedure |                                                           |                                                                     |                                                           |                                                          |                                                                        |                             |                                          |
| Nombre Del destino: Capa de Refined              |                                                           |                                                                     |                                                           |                                                          |                                                                        |                             |                                          |
| Enrutamiento: Dataproc a BigQuery                |                                                           |                                                                     |                                                           |                                                          |                                                                        |                             |                                          |
| Proceso                                          | Descripción                                               | Entidad Origen                                                      | Transformaciones                                          | Entidades Intermedias                                    | Procedimiento Almacenado                                               | Entidad Destino             | Campos Destino                           | Comentarios                                             |
| Carga Inicial                                    | Carga de datos históricos para clientes leales            | `sales_table`, `segment_table`, `model_segment_table`               | Filtrado de clientes válidos, identificación de segmentos | `ClientesValidos`, `SegmentosClientes`                   | `sp_carga_inicial_clientes_leales`                                     | `sp_CalcularClientesLeales` | Fecha, CadenaCD, ModeloSegmentoid, Valor | Carga completa para inicializar el KPI                  |
| Cálculo Diario/Mensual/Anual                     | Cálculo regular del KPI según la granularidad establecida | `sales_table`, `segment_table`, `model_segment_table`               | Filtrado por fecha y segmentación, cálculo de porcentajes | `ClientesTop`, `ClientesLeales`, `TransanccionesTotales` | `sp_clientes_leales_con_exito`, `sp_general_clientes_leales_sin_exito` | `sp_CalcularClientesLeales` | Fecha, CadenaCD, ModeloSegmentoid, Valor | Se calcula con base en la granularidad especificada      |
| Delta                                            | Cálculo incremental de cambios en el KPI                  | `sales_table`, `segment_table_backup`, `model_segment_table_backup` | Detección de cambios en segmentos y clientes              | `ClientesValidos`, `SegmentosClientes`                   | `sp_delta_clientes_leales`                                             | `sp_CalcularClientesLeales` | Fecha, CadenaCD, ModeloSegmentoid, Valor | Detecta y procesa solo los cambios desde la última ejecución |
| Orquestación General                             | Coordinación de cálculos para todas las cadenas           | `sales_table`, `segment_table`, `model_segment_table`               | Lógica condicional basada en la cadena                    | `ClientesTop`, `ClientesLeales`, `TransanccionesTotales` | `sp_clientes_leales`                                                   | `sp_CalcularClientesLeales` | Fecha, CadenaCD, ModeloSegmentoid, Valor | Orquesta el cálculo de KPIs para múltiples cadenas      |
| Punto Final Carga Inicial                        | Ejecución de la carga inicial de datos                    | -                                                                   | -                                                         | -                                                        | `end_point_carga_inicial`                                              | `sp_CalcularClientesLeales` | Fecha, CadenaCD, ModeloSegmentoid, Valor | Punto de entrada para ejecutar la carga inicial         |
| Punto Final Delta                                | Ejecución de la carga delta                               | -                                                                   | -                                                         | -                                                        | `end_point_delta`                                                      | `sp_CalcularClientesLeales` | Fecha, CadenaCD, ModeloSegmentoid, Valor | Punto de entrada para ejecutar cálculos delta           |

# clientes_monitoreados

| Mapeo de datos                                   |                                                                         |                |                                                              |                       |                                          |                                     |                                       |
|--------------------------------------------------|-------------------------------------------------------------------------|----------------|--------------------------------------------------------------|-----------------------|------------------------------------------|-------------------------------------|---------------------------------------|
| Nombre del componente: BigQuery Stored Procedure |                                                                         |                |                                                              |                       |                                          |                                     |                                       |
| Nombre Del destino: Capa de Refined              |                                                                         |                |                                                              |                       |                                          |                                     |                                       |
| Enrutamiento: Dataproc a BigQuery                |                                                                         |                |                                                              |                       |                                          |                                     |                                       |
| Proceso                                          | Descripción                                                             | Entidad Origen | Transformaciones                                             | Entidades Intermedias | Procedimiento Almacenado                 | Entidad Destino                     | Campos Destino                        | Comentarios                                             |
| Carga Inicial                                    | Carga de datos históricos para Clientes Monitoreados MM                 | `sales_table`  | Filtrado de clientes válidos, agrupación por cadena          | `DatosFiltrados`      | `sp_carga_inicial_clientes_monitoreados` | Facts day year month                | Fecha, CadenaCD, NumeroClientesUnicos | Carga completa para inicializar el KPI                  |
| Cálculo Diario/Mensual/Anual                     | Cálculo regular del KPI según la granularidad establecida               | `sales_table`  | Filtrado por fecha y segmentación, conteo de clientes únicos | `DatosFiltrados`      | `sp_general_clientes_monitoreados`       | `sp_CalcularClientesMonitoreadosMM` | Fecha, CadenaCD, NumeroClientesUnicos | Se calcula con base en la granularidad especificada      |
| Delta                                            | Cálculo incremental de cambios en el KPI                                | `sales_table`  | Detección de cambios en clientes y transacciones             | `DatosFiltrados`      | `sp_delta_clientes_monitoreados`         | `sp_CalcularClientesMonitoreadosMM` | Fecha, CadenaCD, NumeroClientesUnicos | Detecta y procesa solo los cambios desde la última ejecución |
| Orquestación General                             | Orquestación de la ejecución de SPs y endpoints para el cálculo de KPIs | -              | -                                                            | -                     |                                          | `sp_CalcularClientesMonitoreadosMM` | Fecha, CadenaCD, NumeroClientesUnicos | Maneja la lógica de ejecución basada en el tipo de carga (completa o delta) y la granularidad |

# dim_cadena

| Mapeo de datos                                   |                                                                      |                |                                        |                       |                          |                    |                                     |
|--------------------------------------------------|----------------------------------------------------------------------|----------------|----------------------------------------|-----------------------|--------------------------|--------------------|-------------------------------------|
| Nombre del componente: BigQuery Stored Procedure |                                                                      |                |                                        |                       |                          |                    |                                     |
| Nombre Del destino: Capa de Refined              |                                                                      |                |                                        |                       |                          |                    |                                     |
| Enrutamiento: Dataproc a BigQuery                |                                                                      |                |                                        |                       |                          |                    |                                     |
| Proceso                                          | Descripción                                                          | Entidad Origen | Transformaciones                       | Entidades Intermedias | Procedimiento Almacenado | Entidad Destino    | Campos Destino                      | Comentarios                                             |
| Creación de Dimensión                            | Creación de la vista de dimensión para cadenas                       | `cadena_table` | Generación de vista con cadenas únicas | -                     | `sp_crear_dim_cadena`    | `dim_cadena_table` | CorporacionCD, CadenaCD, CadenaDesc | Vista que resume las cadenas en una dimensión            |
| Carga Inicial                                    | Ejecución del procedimiento de creación de la vista                  | -              | -                                      | -                     | `endpoint_carga_inicial` | `dim_cadena_table` | CorporacionCD, CadenaCD, CadenaDesc | Punto de entrada para la creación de la vista           |
| Orquestación General                             | Orquestación de la ejecución del script para la creación de la vista | -              | -                                      | -                     |                          | `dim_cadena_table` | CorporacionCD, CadenaCD, CadenaDesc | Maneja la ejecución del script para la creación de la vista |

# dim_indicadores

| Mapeo de datos                                   |                                                                                     |                |                                            |                       |                            |
|--------------------------------------------------|-------------------------------------------------------------------------------------|----------------|--------------------------------------------|-----------------------|----------------------------|
| Nombre del componente: BigQuery Stored Procedure |                                                                                     |                |                                            |                       |                            |                   |                                                                |
| Nombre Del destino: Capa de Refined              |                                                                                     |                |                                            |                       |                            |                   |                                                                |
| Enrutamiento: Dataproc a BigQuery                |                                                                                     |                |                                            |                       |                            |                   |                                                                |
| Proceso                                          | Descripción                                                                         | Entidad Origen | Transformaciones                           | Entidades Intermedias | Procedimiento Almacenado   | Entidad Destino   | Campos Destino                                                 | Comentarios                                             |
| Creación de Dimensión                            | Creación de la tabla de dimensión para indicadores                                  | -              | Generación de tabla con indicadores únicos | -                     | `sp_crear_dim_indicadores` | `dim_indicadores` | IndicadorKey, Indicador, Tipo, Descripcion, FechaActualizacion | Tabla que resume los indicadores en una dimensión        |
| Carga Inicial                                    | Ejecución del procedimiento de creación de la tabla de indicadores                  | -              | -                                          | -                     | `endpoint_carga_inicial`   | `dim_indicadores` | IndicadorKey, Indicador, Tipo, Descripcion, FechaActualizacion | Punto de entrada para la creación de la tabla de indicadores |
| Orquestación General                             | Orquestación de la ejecución del script para la creación de la tabla de indicadores | -              | -                                          | -                     |                            | `dim_indicadores` | IndicadorKey, Indicador, Tipo, Descripcion, FechaActualizacion | Maneja la ejecución del script para la creación de la tabla de indicadores |

# indicadores_manuales

| Mapeo de datos                                    |                                                                                                                        |                         |                                                                                                                                        | Proceso                                          |                                           |                             |                                                                            |
|---------------------------------------------------|------------------------------------------------------------------------------------------------------------------------|-------------------------|----------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------|-------------------------------------------|-----------------------------|----------------------------------------------------------------------------|
| Nombre del componente: BigQuery Stored Procedure  |                                                                                                                        |                         |                                                                                                                                        |                                                  |                                           |                             |                                                                            |
| Nombre Del destino: Capa de Refined               |                                                                                                                        |                         |                                                                                                                                        |                                                  |                                           |                             |                                                                            |
| Enrutamiento: Dataproc a BigQuery                 |                                                                                                                        |                         |                                                                                                                                        |                                                  |                                           |                             |                                                                            |
| Proceso                                           | Descripción                                                                                                            | Entidad Origen          | Transformaciones                                                                                                                       | Entidades Intermedias                            | Procedimiento Almacenado                  | Entidad Destino             | Campos Destino                                                             | Comentarios                                             |
| Actualización de Indicadores Manuales             | Proceso de fusión y actualización de indicadores manuales desde una tabla fuente hacia una tabla objetivo en BigQuery. | `source_table`          | Fusión de datos entre tablas, actualización de valores existentes, e inserción de nuevos registros basados en condiciones específicas. | -                                                | `sp_merge_indicadores_manuales`           | `target_table`              | Fecha, CadenaCD, ModeloSegmentoid, IndicadorKey, Valor, FechaActualizacion | Actualización delta de indicadores manuales utilizando MERGE para garantizar la consistencia y actualidad de los datos. |


# indicadores_metas

| Mapeo de datos                                   |                                                                                                                            |                |                                                                                                                                        | Proceso               |                              |                 |                                                                            |
|--------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------|----------------|----------------------------------------------------------------------------------------------------------------------------------------|-----------------------|------------------------------|-----------------|----------------------------------------------------------------------------|
| Nombre del componente: BigQuery Stored Procedure |                                                                                                                            |                |                                                                                                                                        |                       |                              |                 |                                                                            |
| Nombre Del destino: Capa de Refined              |                                                                                                                            |                |                                                                                                                                        |                       |                              |                 |                                                                            |
| Enrutamiento: Dataproc a BigQuery                |                                                                                                                            |                |                                                                                                                                        |                       |                              |                 |                                                                            |
| Proceso                                          | Descripción                                                                                                                | Entidad Origen | Transformaciones                                                                                                                       | Entidades Intermedias | Procedimiento Almacenado     | Entidad Destino | Campos Destino                                                             | Comentarios                                             |
| Actualización de Metas de Indicadores            | Proceso de fusión y actualización de las metas de indicadores desde una tabla fuente hacia una tabla objetivo en BigQuery. | `source_table` | Fusión de datos entre tablas, actualización de valores existentes, e inserción de nuevos registros basados en condiciones específicas. | -                     | `sp_merge_indicadores_metas` | `target_table`  | Fecha, CadenaCD, ModeloSegmentoid, IndicadorKey, Valor, FechaActualizacion | Actualización delta de metas de indicadores utilizando MERGE para garantizar la consistencia y actualidad de los datos. |


# porcentaje_contectabilidad

| Mapeo de datos                                   |                                                                                                                                  |                                |                                                                      | Proceso                                   |                                               |                 |                                                                            |
|--------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------|--------------------------------|----------------------------------------------------------------------|-------------------------------------------|-----------------------------------------------|-----------------|----------------------------------------------------------------------------|
| Nombre del componente: BigQuery Stored Procedure |                                                                                                                                  |                                |                                                                      |                                           |                                               |                 |                                                                            |
| Nombre Del destino: Capa de Refined              |                                                                                                                                  |                                |                                                                      |                                           |                                               |                 |                                                                            |
| Enrutamiento: Dataproc a BigQuery                |                                                                                                                                  |                                |                                                                      |                                           |                                               |                 |                                                                            |
| Proceso                                          | Descripción                                                                                                                      | Entidad Origen                 | Transformaciones                                                     | Entidades Intermedias                     | Procedimiento Almacenado                      | Entidad Destino | Campos Destino                                                             | Comentarios                                             |
| Cálculo de Porcentaje de Contactabilidad         | Cálculo del porcentaje de clientes activos con al menos un canal de comunicación registrado frente al total de clientes activos. | `sales_table`, `contact_table` | Agrupación mensual, conteo de clientes activos y contactables.       | `ClientesActivos`, `ClientesContactables` | `sp_general_porcentaje_contactabilidad`       | `temp_table`    | Fecha, CadenaCD, ModeloSegmentoid, Valor                                   | Agrupación y cálculo realizado mensualmente.             |
| Actualización Delta de Contactabilidad           | Actualización delta de porcentaje de contactabilidad utilizando datos acumulados al cierre del mes.                              | `temp_table`                   | Fusión de datos en la tabla final basada en condiciones específicas. | -                                         | `sp_delta_porcentaje_contactabilidad`         | `final_table`   | Fecha, CadenaCD, ModeloSegmentoid, IndicadorKey, Valor, FechaActualizacion | Actualización condicional para reflejar datos más recientes. |
| Carga Inicial de Contactabilidad                 | Carga inicial de porcentaje de contactabilidad para el rango de fechas especificado.                                             | `temp_table`                   | -                                                                    | -                                         | `sp_carga_inicial_porcentaje_contactabilidad` | `final_table`   | Fecha, CadenaCD, ModeloSegmentoid, IndicadorKey, Valor, FechaActualizacion | Utilizado para inicializar o restablecer el KPI en la tabla de destino. |
| Orquestación de Carga Delta                      | Orquestación de la carga delta para actualización de porcentaje de contactabilidad.                                              | -                              | -                                                                    | -                                         | `endpoint_delta`                              | `final_table`   | Fecha, CadenaCD, ModeloSegmentoid, IndicadorKey, Valor, FechaActualizacion | Ejecución programada o disparada por evento.              |
| Orquestación de Carga Inicial                    | Orquestación de la carga inicial para el KPI de porcentaje de contactabilidad.                                                   | -                              | -                                                                    | -                                         | `endpoint_carga_inicial`                      | `final_table`   | Fecha, CadenaCD, ModeloSegmentoid, IndicadorKey, Valor, FechaActualizacion | Utilizado para establecer el estado inicial de los datos. |

# tasa_retencion

| Mapeo de datos                                   |                                                                                                            |                |                                                                         | Proceso                                                         |                                  |                 |                                                                            |
|--------------------------------------------------|------------------------------------------------------------------------------------------------------------|----------------|-------------------------------------------------------------------------|-----------------------------------------------------------------|----------------------------------|-----------------|----------------------------------------------------------------------------|
| Nombre del componente: BigQuery Stored Procedure |                                                                                                            |                |                                                                         |                                                                 |                                  |                 |                                                                            |
| Nombre Del destino: Capa de Refined              |                                                                                                            |                |                                                                         |                                                                 |                                  |                 |                                                                            |
| Enrutamiento: Dataproc a BigQuery                |                                                                                                            |                |                                                                         |                                                                 |                                  |                 |                                                                            |
| Proceso                                          | Descripción                                                                                                | Entidad Origen | Transformaciones                                                        | Entidades Intermedias                                           | Procedimiento Almacenado         | Entidad Destino | Campos Destino                                                             | Comentarios                                             |
| Cálculo de Tasa de Retención                     | Cálculo de la proporción de clientes del año anterior que continúan realizando compras en el año en curso. | `sales_table`  | Identificación de clientes retenidos y cálculo de la tasa de retención. | `ClientesMesAnterior`, `ClientesMesActual`, `ClientesRetenidos` | `sp_general_tasa_retencion`      | `temp_table`    | Fecha, CadenaCD, PorcentajeRetencion                                       | Cálculo realizado mes a mes y reinicio anual.             |
| Actualización Delta de Tasa de Retención         | Actualización delta de la tasa de retención para reflejar datos más recientes.                             | `temp_table`   | Fusión de datos en la tabla final basada en condiciones específicas.    | -                                                               | `sp_delta_tasa_retencion`        | `final_table`   | Fecha, CadenaCD, ModeloSegmentoid, IndicadorKey, Valor, FechaActualizacion | Actualización condicional para el último mes calculado.   |
| Carga Inicial de Tasa de Retención               | Carga inicial de la tasa de retención para el rango de fechas especificado.                                | `temp_table`   | -                                                                       | -                                                               | `sp_carga_inicial_carga_inicial` | `final_table`   | Fecha, CadenaCD, ModeloSegmentoid, IndicadorKey, Valor, FechaActualizacion | Utilizado para inicializar o restablecer el KPI.          |
| Orquestación de Carga Delta                      | Orquestación de la carga delta para actualización de la tasa de retención.                                 | -              | -                                                                       | -                                                               | `endpoint_delta`                 | `final_table`   | Fecha, CadenaCD, ModeloSegmentoid, IndicadorKey, Valor, FechaActualizacion | Ejecución programada o disparada por evento.              |
| Orquestación de Carga Inicial                    | Orquestación de la carga inicial para el KPI de tasa de retención.                                         | -              | -                                                                       | -                                                               | `endpint_carga_inicial`          | `final_table`   | Fecha, CadenaCD, ModeloSegmentoid, IndicadorKey, Valor, FechaActualizacion | Utilizado para establecer el estado inicial de los datos. |


# transacciones_monitoreadas

| Mapeo de datos                                   |                                                                                                  |                |                                                                |                       |                                               |                 |                                                                            |
|--------------------------------------------------|--------------------------------------------------------------------------------------------------|----------------|----------------------------------------------------------------|-----------------------|-----------------------------------------------|-----------------|----------------------------------------------------------------------------|
| Nombre del componente: BigQuery Stored Procedure |                                                                                                  |                |                                                                |                       |                                               |                 |                                                                            |
| Nombre Del destino: Capa de Refined              |                                                                                                  |                |                                                                |                       |                                               |                 |                                                                            |
| Enrutamiento: Dataproc a BigQuery                |                                                                                                  |                |                                                                |                       |                                               |                 |                                                                            |
| Proceso                                          | Descripción                                                                                      | Entidad Origen | Transformaciones                                               | Entidades Intermedias | Procedimiento Almacenado                      | Entidad Destino | Campos Destino                                                             | Comentarios                                             |
| Cálculo de Transacciones Monitoreadas            | Mide el número de transacciones con identificación del cliente, excluyendo aquellas sin PartyId. | `sales_table`  | Filtrado y agrupación por cadena y fecha según granularidad.   | -                     | `sp_general_transacciones_monitoreadas`       | `temp_table`    | Fecha, CadenaCD, NumeroTransacciones                                       | Calculado diariamente con agrupación mensual y anual.    |
| Actualización Delta de Transacciones             | Actualización delta para reflejar transacciones recientes.                                       | `temp_table`   | Fusión de datos en la tabla final con condiciones específicas. | -                     | `sp_delta_transacciones_monitoreadas`         | `final_table`   | Fecha, CadenaCD, ModeloSegmentoid, IndicadorKey, Valor, FechaActualizacion | Actualización condicional para el último periodo calculado.|
| Carga Inicial de Transacciones Monitoreadas      | Carga inicial para el rango de fechas especificado.                                              | `temp_table`   | -                                                              | -                     | `sp_carga_inicial_transacciones_monitoreadas` | `final_table`   | Fecha, CadenaCD, ModeloSegmentoid, IndicadorKey, Valor, FechaActualizacion | Utilizado para inicializar o restablecer el KPI.          |
| Orquestación de Carga Delta                      | Orquestación de la carga delta para actualización de transacciones monitoreadas.                 | -              | -                                                              | -                     | `endpoint_delta`                              | `final_table`   | Fecha, CadenaCD, ModeloSegmentoid, IndicadorKey, Valor, FechaActualizacion | Ejecución programada o disparada por evento.              |
| Orquestación de Carga Inicial                    | Orquestación de la carga inicial para el KPI de transacciones monitoreadas.                      | -              | -                                                              | -                     | `endpoint_carga_inicial`                      | `final_table`   | Fecha, CadenaCD, ModeloSegmentoid, IndicadorKey, Valor, FechaActualizacion | Utilizado para establecer el estado inicial de los datos. |


# ventas_clientes_leales

| Mapeo de datos                                   |                                                                              |                                                       |                                                                | Proceso               |                                                                                                                                   |                 |                                                                            |
|--------------------------------------------------|------------------------------------------------------------------------------|-------------------------------------------------------|----------------------------------------------------------------|-----------------------|-----------------------------------------------------------------------------------------------------------------------------------|-----------------|----------------------------------------------------------------------------|
| Nombre del componente: BigQuery Stored Procedure |                                                                              |                                                       |                                                                |                       |                                                                                                                                   |                 |                                                                            |
| Nombre Del destino: Capa de Refined              |                                                                              |                                                       |                                                                |                       |                                                                                                                                   |                 |                                                                            |
| Enrutamiento: Dataproc a BigQuery                |                                                                              |                                                       |                                                                |                       |                                                                                                                                   |                 |                                                                            |
| Proceso                                          | Descripción                                                                  | Entidad Origen                                        | Transformaciones                                               | Entidades Intermedias | Procedimiento Almacenado                                                                                                          | Entidad Destino | Campos Destino                                                             | Comentarios                                             |
| Ventas de Clientes Leales                        | Identifica y calcula las ventas de clientes leales para cada cadena.         | `sales_table`, `segment_table`, `model_segment_table` | Filtrado por clientes leales, cálculo de ventas segmentadas.   | -                     | `sp_general_ventas_clientes_leales`, `sp_general_ventas_clientes_leales_con_exito`, `sp_general_ventas_clientes_leales_sin_exito` | `temp_table`    | Fecha, CadenaCD, ModeloSegmentoid, Valor                                   | Calcula ventas de clientes leales por cadena.    |
| Actualización Delta de Ventas Clientes Leales    | Actualiza las ventas de clientes leales para el periodo más reciente.        | `temp_table`                                          | Fusión de datos en la tabla final con condiciones específicas. | -                     | `sp_delta_ventas_clientes_leales`                                                                                                 | `final_table`   | Fecha, CadenaCD, ModeloSegmentoid, IndicadorKey, Valor, FechaActualizacion | Actualización condicional para el último periodo calculado.|
| Carga Inicial de Ventas Clientes Leales          | Carga inicial para el rango de fechas especificado.                          | `temp_table`                                          | -                                                              | -                     | `sp_carga_inicial_ventas_clientes_leales`                                                                                         | `final_table`   | Fecha, CadenaCD, ModeloSegmentoid, IndicadorKey, Valor, FechaActualizacion | Utilizado para inicializar o restablecer el KPI.          |
| Orquestación de Carga Delta                      | Orquestación de la carga delta para actualización de ventas clientes leales. | -                                                     | -                                                              | -                     | `endpoint_delta`                                                                                                                  | `final_table`   | Fecha, CadenaCD, ModeloSegmentoid, IndicadorKey, Valor, FechaActualizacion | Ejecución programada o disparada por evento.              |
| Orquestación de Carga Inicial                    | Orquestación de la carga inicial para el KPI de ventas clientes leales.      | -                                                     | -                                                              | -                     | `endpoint_carga_inicial`                                                                                                          | `final_table`   | Fecha, CadenaCD, ModeloSegmentoid, IndicadorKey, Valor, FechaActualizacion | Utilizado para establecer el estado inicial de los datos. |


# ventas_totales

| Mapeo de datos                                   |                                                                              |                |                                                                | Proceso               |                                   |                 |                                                                            |
|--------------------------------------------------|------------------------------------------------------------------------------|----------------|----------------------------------------------------------------|-----------------------|-----------------------------------|-----------------|----------------------------------------------------------------------------|
| Nombre del componente: BigQuery Stored Procedure |                                                                              |                |                                                                |                       |                                   |                 |                                                                            |
| Nombre Del destino: Capa de Refined              |                                                                              |                |                                                                |                       |                                   |                 |                                                                            |
| Enrutamiento: Dataproc a BigQuery                |                                                                              |                |                                                                |                       |                                   |                 |                                                                            |
| Proceso                                          | Descripción                                                                  | Entidad Origen | Transformaciones                                               | Entidades Intermedias | Procedimiento Almacenado          | Entidad Destino | Campos Destino                                                             | Comentarios                                             |
| Ventas Totales sin IVA MM                        | Calcula las ventas totales sin IVA por cadena.                               | `sales_table`  | Filtrado por criterios, cálculo de ventas sin IVA.             | -                     | `sp_general_ventas_totales`       | `temp_table`    | Fecha, CadenaCD, VentaTotalEnMilesDeMillones                               | Calcula ventas por día, mes o año según granularidad. |
| Actualización Delta de Ventas Totales            | Actualiza las ventas totales sin IVA para el periodo más reciente.           | `temp_table`   | Fusión de datos en la tabla final con condiciones específicas. | -                     | `sp_delta_ventas_totales`         | `final_table`   | Fecha, CadenaCD, ModeloSegmentoid, IndicadorKey, Valor, FechaActualizacion | Actualización condicional para el último periodo calculado.|
| Carga Inicial de Ventas Totales                  | Carga inicial para el rango de fechas especificado.                          | `temp_table`   | -                                                              | -                     | `sp_carga_inicial_ventas_totales` | `final_table`   | Fecha, CadenaCD, ModeloSegmentoid, IndicadorKey, Valor, FechaActualizacion | Utilizado para inicializar o restablecer el KPI.          |
| Orquestación de Carga Delta                      | Orquestación de la carga delta para actualización de ventas totales sin IVA. | -              | -                                                              | -                     | `endpoint_delta`                  | `final_table`   | Fecha, CadenaCD, ModeloSegmentoid, IndicadorKey, Valor, FechaActualizacion | Ejecución programada o disparada por evento.              |
| Orquestación de Carga Inicial                    | Orquestación de la carga inicial para el KPI de ventas totales sin IVA.      | -              | -                                                              | -                     | `endpoint_carga_inicial`          | `final_table`   | Fecha, CadenaCD, ModeloSegmentoid, IndicadorKey, Valor, FechaActualizacion | Utilizado para establecer el estado inicial de los datos. |

